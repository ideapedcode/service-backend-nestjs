# Smart Shop API

NestJS-based backend for an e-commerce experience covering authentication, catalog, cart, order, and file-upload flows. The service uses MongoDB for persistence, Passport + JWT for security, and ships with ready-to-run Docker tooling plus autogenerated Swagger docs.

## Features
- JWT authentication with local login, refresh, and guarded endpoints.
- User, product, category, cart, and order modules with DTO validation.
- File uploads stored under `uploads/` and exposed as static assets.
- Centralized validation, exception filtering, and request logging middleware.
- API documentation via Swagger at `/api/docs`.
- Docker Compose setup for pairing the API with MongoDB.

## Tech Stack
- [NestJS 10](https://docs.nestjs.com/) + TypeScript
- MongoDB via Mongoose ODM
- Passport (local + JWT strategies)
- Swagger/OpenAPI tooling
- Jest for unit testing, ESLint + Prettier for code quality
- Docker & Docker Compose for containerized development

## Getting Started
1. **Install prerequisites**: Node.js ≥ 18, npm (or Yarn/PNPM), Docker (optional).
2. **Install dependencies**:
   ```bash
   npm install
   ```
3. **Configure environment variables**:
   ```bash
   cp .env.example .env
   ```
   Update the values as needed (see the table below). `PORT` defaults to `3000` if omitted.

### Environment Variables
| Variable      | Example / Default                | Purpose                          |
|---------------|----------------------------------|----------------------------------|
| `NODE_ENV`    | `development`                    | Runtime mode.                    |
| `PORT`        | `3001` (`3000` fallback)         | HTTP port exposed by the API.    |
| `MONGO_URI`   | `mongodb://mongo:27017/db-smart-shop` | MongoDB connection string.  |
| `JWT_SECRET`  | `supersecretkey`                 | Secret used to sign tokens.      |
| `JWT_EXPIRES_IN` | `1h`                          | Access token TTL.                |
| `UPLOAD_PATH` | `uploads`                        | Directory for user uploads.      |

## Useful npm Scripts
| Script              | Description                               |
|---------------------|-------------------------------------------|
| `npm run start`     | Start the app in production mode.         |
| `npm run start:dev` | Start with file watching + live reload.   |
| `npm run start:prod`| Run the compiled bundle from `dist/`.     |
| `npm run build`     | Compile TypeScript to JavaScript.         |
| `npm run lint`      | Lint `src/` and `test/` with ESLint.      |
| `npm run format`    | Format `src/**/*.ts` with Prettier.       |
| `npm test`          | Execute the Jest test suite.              |
| `npm run test:watch`| Watch mode for tests.                     |
| `npm run test:cov`  | Generate coverage reports.                |

## Running the Service
### Local development
```bash
npm run start:dev
```
Visit `http://localhost:<PORT or 3000>/api/docs` for Swagger UI and `http://localhost:<PORT or 3000>/uploads/...` for exposed assets.

### Production build (without Docker)
```bash
npm run build
npm run start:prod
```

### Docker Compose
```bash
docker-compose up --build
```
This spins up the API and a MongoDB instance. Uploaded files are persisted via the `uploads/` bind mount.

## Tests & Quality Gates
- `npm test` / `npm run test:watch` for the Jest suite.
- `npm run test:cov` to ensure coverage requirements are met.
- `npm run lint` and `npm run format` before pushing changes.

## Project Structure
```
src/
├─ main.ts                # App bootstrap (pipes, filters, Swagger, static assets)
├─ app.module.ts          # Root module wiring
├─ common/                # Filters, interceptors, and shared utilities
├─ config/                # Configuration providers (env, database, storage)
└─ modules/
   ├─ auth/               # Auth controllers, services, strategies
   ├─ user/               # User entities and CRUD operations
   ├─ product/            # Product/catalog management
   ├─ category/           # Product categories
   ├─ cart/               # Shopping cart workflows
   └─ order/              # Order placement + status tracking
```

## API Documentation
Swagger is served at `/api/docs` once the server is running. The setup includes bearer authentication, so you can authenticate and interact with protected routes directly from the UI.

## File Uploads
Uploads are stored in the folder defined by `UPLOAD_PATH` (defaults to `uploads/`). Ensure the directory exists locally or provide write permissions in Docker volumes so assets can be persisted.
